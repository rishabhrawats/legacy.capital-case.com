document.addEventListener("DOMContentLoaded",(()=>{let e=[...document.querySelectorAll(".multistep-form-step")],t=document.querySelector(".multistep-form-progressbar-progress"),o=document.querySelector(".get-the-framework-modal"),r=document.querySelectorAll("#blurred-bg-close-gfm, #close-gfm"),a=0,d={},n="https://founderos.app.n8n.cloud/webhook/newsletter-partial";const l=()=>{t.style.width=(a+1)/e.length*100+"%"},s=()=>{document.querySelectorAll(".gfm-form input, .gfm-form select, .gfm-form textarea").forEach((e=>{const t=e.name||e.id;t&&("checkbox"===e.type?d[t]=e.checked:"radio"===e.type?e.checked&&(d[t]=e.value):d[t]=e.value.trim())}))},c=t=>{const o=e[a];([...o.querySelectorAll("input[required]")].every((e=>{const t=o.querySelector(`[data-error-for="${e.id}"]`);let r=!!e.value.trim(),a="";return!r&&t?(t.textContent=a||"This field is required.",t.classList.remove("hide")):t&&t.classList.add("hide"),"email"===e.type&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim())||(r=!1,a="Please enter a valid email address.")),r}))||1!==t)&&(e[a].style.display="none",a+=t,e[a].style.display="block",l(),window.fathom&&(window.trackedSteps=window.trackedSteps||new Set,window.trackedSteps.has(a)||(fathom.trackEvent("Get Framework Modal (Step: $ {\n            r+1\n        }\n        )"),window.trackedSteps.add(a))),(async()=>{s();try{await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"partial",formData:d,step:a,timestamp:(new Date).toISOString()})})}catch(e){console.error("Partial data send failed:",e)}})())};e.forEach(((e,t)=>{e.style.display=0===t?"block":"none",e.querySelector(".msf-button")?.addEventListener("click",(e=>{e.preventDefault(),c(1)})),e.querySelector(".msf-back-button")?.addEventListener("click",(e=>{e.preventDefault(),a>0&&c(-1)}))})),l(),r.forEach((e=>{e.addEventListener("click",(()=>{o&&(o.style.display="none",document.body.style.overflow="")}))})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&o?(o.style.display="none",document.body.style.overflow=""):"Enter"===t.key&&(t.preventDefault(),a<e.length-1&&c(1))})),document.querySelectorAll(".gtf-cta").forEach((e=>{e.addEventListener("click",(()=>{const t=document.querySelector(".gfm-form");t&&(t.dataset.fathom=e.dataset.fathom,t.id=e.id),o&&(o.style.display="block",window.fathom&&(window.trackedSteps=window.trackedSteps||new Set,window.trackedSteps.has(0)||(fathom.trackEvent("Get Framework Modal (Step: 1)"),window.trackedSteps.add(0))))}))})),document.querySelectorAll(".gfm-form").forEach((e=>{e.addEventListener("submit",(e=>{fathom.trackEvent("Get Framework Modal Form Submit")}))})),window.addEventListener("beforeunload",(async()=>{s();try{await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"partial",formData:d,step:a,timestamp:(new Date).toISOString()}),keepalive:!0})}catch(e){console.error("Failed to send data before unload:",e)}}))}));